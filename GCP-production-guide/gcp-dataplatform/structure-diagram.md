
                            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                            â”‚     External Data Sources     â”‚
                            â”‚  (Vendors, Internal Systems)  â”‚
                            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                            â”‚  ingest
                                            â–¼
                          â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
                          â•‘      Google Cloud Storage (GCS)    â•‘
                          â•‘  Raw Data Lake / File Staging      â•‘
                          â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•¤â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                                           â”‚ load into BQ
                                           â–¼
             â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
             â•‘                         BigQuery (DWH)                      â•‘
             â•‘  Raw â†’ Clean â†’ Intermediate â†’ SOT â†’ Downstream Views        â•‘
             â•‘  - SQL transforms                                            â•‘
             â•‘  - Partition / Clustering                                   â•‘
             â•‘  - Cost-based execution                                     â•‘
             â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•¤â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                              â”‚ queried/updated by Tasks
                              â–¼
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚            Cloud Composer (Airflow Orchestrator)              â”‚
            â”‚  - DAG Schedule                                               â”‚
            â”‚  - Dependencies                                               â”‚
            â”‚  - Retries / Monitoring                                      â”‚
            â”‚  - Sends tasks to executors below                             â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚                              â”‚
                            â–¼                              â–¼
      â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—              â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
      â•‘ BigQuery Operators       â•‘              â•‘ Python Operators           â•‘
      â•‘ - Executes SQL           â•‘              â•‘ - Light data processing    â•‘
      â•‘ - Builds SOT tables      â•‘              â•‘ - Validation, DQ checks   â•‘
      â•šâ•â•â•â•â•â•â•â•â•â•â•â•¤â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•              â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•¤â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                  â”‚                                             â”‚ heavy compute
                  â–¼                                             â–¼
      â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—              â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
      â•‘ BigQuery Execution Engineâ•‘              â•‘ KubernetesPodOperator      â•‘
      â•‘  (Queries, Joins, ETL)   â•‘              â•‘ + Docker Containers        â•‘
      â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•              â•‘  ML / Large batch jobs     â•‘
                                                â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                                                  
                            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                            â”‚         Downstream Consumers           â”‚
                            â”‚  - Looker Dashboard                    â”‚
                            â”‚  - Forecast Models (CGPen, etc.)       â”‚
                            â”‚  - Internal APIs / Reporting systems   â”‚
                            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜



ğŸŒŸ å›¾ç»“æ„è¯´æ˜
â‘  ä¸Šæ¸¸æ•°æ® â†’ GCS

åŸå§‹æ•°æ®é€šå¸¸å…ˆè½åˆ° GCS

ä½ ä»¬å›¢é˜Ÿæœ‰äº›æ•°æ®èµ° BigQuery directlyï¼Œä½†æœ‰äº›æ˜¯ GCS â†’ BQ

â‘¡ BigQuery æ˜¯æ•´ä¸ªç³»ç»Ÿçš„ä¸­å¿ƒ

ä½ æ‰€æœ‰çš„ï¼š

SOT

æ¸…æ´—è¡¨

ä¸­é—´å±‚

ä¸‹æ¸¸ dashboard æ•°æ®

å…¨éƒ¨æ¥è‡ª BigQueryã€‚

ä½ ç°åœ¨æœ€ç†Ÿæ‚‰çš„å±‚å°±æ˜¯è¿™ä¸€å±‚ï¼Œä½ å·²ç»åšå¾—éå¸¸å¥½ã€‚

â‘¢ Composer æ˜¯ orchestratorï¼ˆæ§åˆ¶ä¸­å¿ƒï¼‰

DAG æ¯å¤©å®šæ—¶è§¦å‘

è‡ªåŠ¨è¿è¡Œä½ å†™å¥½çš„ SQL â†’ æ›´æ–° SOT

å¯ä»¥åŒæ—¶è·‘ Python tasksï¼ˆæ•°æ®è´¨é‡æ£€æŸ¥ï¼‰

å¯ä»¥è°ƒç”¨ Docker/Kubernetes è·‘å¤§ä»»åŠ¡

â‘£ ä¸‰ç§æ‰§è¡Œæ–¹å¼ï¼ˆä½ å¿…é¡»æŒæ¡çš„å…³é”®ï¼‰

è¿™å¼ å›¾ç‰¹åˆ«é‡è¦ï¼Œå› ä¸º debug 90% çš„é—®é¢˜éƒ½æ˜¯å‡ºåœ¨è¿™é‡Œï¼š

BigQueryOperator â†’ BigQuery Engine

é€‚åˆï¼š

æ‰€æœ‰æ•°æ®è½¬æ¢ï¼ˆä½ ç°åœ¨åšçš„éƒ¨åˆ†ï¼‰

PythonOperator â†’ Composer Worker

é€‚åˆï¼š

å°è®¡ç®—

æ•°æ®æ£€æŸ¥ï¼ˆå­—æ®µ/æ ·æœ¬/è¾¹ç•Œæµ‹è¯•ï¼‰

API è¯·æ±‚

å­—æ®µå¯¹é½éªŒè¯ï¼ˆä½ ç°åœ¨åœ¨åšçš„ï¼‰

KubernetesPodOperator â†’ GKE + Docker

é€‚åˆï¼š

å¤§è§„æ¨¡å†å²æ•°æ®å›å¡«

æœºå™¨å­¦ä¹ æ¨¡å‹è®­ç»ƒ

å¤§é‡ Python ä¾èµ–çš„ä»»åŠ¡ï¼ˆpandas æˆ– sklearnï¼‰

Wayfair çš„ Forecast/MLE pipeline å°±ä¼šç”¨è¿™ä¸ªã€‚
